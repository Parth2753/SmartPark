<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SmartPark AI</title>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.jsdelivr.net/npm/qrcode/build/qrcode.min.js"></script>

<style>
@import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@500&display=swap');

:root{
  --bg:#0c0c0f;
  --txt:#00fff0;
  --free:#00ff7f;
  --booked:#ff073a;
}

body{
  background:var(--bg);
  color:var(--txt);
  font-family:'Orbitron',sans-serif;
  margin:0;
}

header{
  padding:15px;
  text-align:center;
  background:#001f2d;
  box-shadow:0 0 20px var(--txt);
}

main{padding:20px}

button{
  border:1px solid var(--txt);
  background:none;
  color:var(--txt);
  padding:6px 12px;
  cursor:pointer;
}

#parkingGrid{
  display:grid;
  grid-template-columns:repeat(5,1fr);
  gap:10px;
}

.slot{
  padding:15px;
  border-radius:10px;
  font-weight:bold;
  text-align:center;
  cursor:pointer;
}

.free{background:var(--free); color:black}
.booked{background:var(--booked); color:black}

form, section{
  margin-top:20px;
  padding:15px;
  background:rgba(0,0,0,0.6);
  border-radius:10px;
  box-shadow:0 0 15px var(--txt);
}

input, select{
  background:black;
  color:var(--txt);
  border:1px solid var(--txt);
  margin-left:5px;
}

table{
  width:100%;
  margin-top:15px;
  border-collapse:collapse;
}

table,th,td{
  border:1px solid var(--txt);
  padding:6px;
  text-align:center;
}

#liveRegister li{
  margin:6px 0;
}
</style>
</head>

<body>

<header>
<h1>SmartPark AI</h1>
</header>

<main>

<h2>Parking Slots</h2>
<div id="parkingGrid"></div>

<form id="bookingForm">
<h2>Register Vehicle</h2>
<label>Name <input id="userName" required></label><br><br>
<label>Vehicle No <input id="vehicleNo" required></label><br><br>
<label>Type 
<select id="vehicleType">
<option>Car</option>
<option>Bike</option>
<option>EV</option>
</select>
</label><br><br>
<label>Slot <input type="number" id="slotNumber" min="1" max="20" required></label><br><br>
<button>Book Slot</button>
</form>

<section>
<h2>Search Vehicle</h2>
<input id="searchVehicle" placeholder="Vehicle Number">
<button onclick="searchVehicle()">Search</button>
<p id="searchResult"></p>
</section>

<section>
<h2>Checkout Vehicle</h2>
<input type="number" id="checkoutSlot" placeholder="Slot Number">
<button onclick="checkoutVehicle()">Checkout</button>
</section>

<section>
<h2>Live Parking Register</h2>
<ul id="liveRegister"></ul>
</section>

<section>
<h2>Booking History</h2>
<table>
<thead>
<tr>
<th>Slot</th><th>Name</th><th>Vehicle</th><th>Type</th><th>Time</th><th>Fee</th>
</tr>
</thead>
<tbody id="historyTable"></tbody>
</table>
</section>

<canvas id="chart"></canvas>

</main>

<script>
const totalSlots = 20;
const parkingGrid = document.getElementById("parkingGrid");
const historyTable = document.getElementById("historyTable");

let slots = JSON.parse(localStorage.getItem("slots")) || [];
let bookings = JSON.parse(localStorage.getItem("bookings")) || [];

// INIT
if (slots.length !== totalSlots) {
  slots = [];
  for (let i = 1; i <= totalSlots; i++) {
    slots.push({
      number: i,
      status: "free",
      vehicleNo: "",
      vehicleType: "",
      owner: ""
    });
  }
  localStorage.setItem("slots", JSON.stringify(slots));
}
// GRID
function renderGrid(){
  parkingGrid.innerHTML="";
  slots.forEach(s=>{
    const d=document.createElement("div");
    d.className=`slot ${s.status}`;
    d.innerHTML = s.status==="free"
      ? `Slot ${s.number}<br>FREE`
      : `Slot ${s.number}<br>${s.vehicleNo}<br>${s.vehicleType}`;
    d.onclick=()=>document.getElementById("slotNumber").value=s.number;
    parkingGrid.appendChild(d);
  });
}

// REGISTER
document.getElementById("bookingForm").onsubmit=e=>{
  e.preventDefault();
  const name=userName.value;
  const vno=vehicleNo.value;
  const vtype=vehicleType.value;
  const sn=Number(slotNumber.value);
  const i=slots.findIndex(s=>s.number===sn);

  if(slots[i].status==="booked"){alert("Already booked");return;}

  slots[i].status="booked";
  slots[i].vehicleNo=vno;
  slots[i].vehicleType=vtype;
  slots[i].owner=name;

  bookings.push({slot:sn,name,vno,vtype,time:Date.now()});

  localStorage.setItem("slots",JSON.stringify(slots));
  localStorage.setItem("bookings",JSON.stringify(bookings));

  renderAll();
  e.target.reset();
};

// SEARCH
function searchVehicle(){
  const v=searchVehicleInput.value;
  const s=slots.find(x=>x.vehicleNo===v);
  searchResult.innerHTML = s
    ? `Found in Slot ${s.number} (${s.vehicleType})`
    : "Not found";
}
  function updateLiveRegister(){
  liveRegister.innerHTML = "";

  slots
    .filter(s => s.status === "booked")
    .forEach(s => {

      const booking = bookings.find(
        b => b.slot === s.number && b.timeOut === null
      );

      if (!booking) return;

      const duration = getLiveDuration(booking.timeIn);

      const li = document.createElement("li");
      li.innerHTML = `
        Slot ${s.number} → ${s.vehicleNo} (${s.vehicleType})<br>
        ⏱️ Parked: ${duration}
      `;
      liveRegister.appendChild(li);
    });
}
// CHECKOUT
function checkoutVehicle(){
  const sn=Number(checkoutSlot.value);
  const i=slots.findIndex(s=>s.number===sn);

  if(i===-1 || slots[i].status==="free"){
    alert("Invalid slot");
    return;
  }

  slots[i]={number:sn,status:"free",vehicleNo:"",vehicleType:"",owner:""};
  localStorage.setItem("slots",JSON.stringify(slots));
  renderAll();
}

// LIVE REGISTER
function updateLiveRegister(){
  liveRegister.innerHTML="";
  slots.filter(s=>s.status==="booked").forEach(s=>{
    const li=document.createElement("li");
    li.textContent=`Slot ${s.number} → ${s.vehicleNo} (${s.vehicleType})`;
    liveRegister.appendChild(li);
  });
}

// HISTORY
function renderHistory(){
  historyTable.innerHTML="";
  bookings.forEach(b=>{
    const fee=20;
    historyTable.innerHTML+=`
    <tr>
      <td>${b.slot}</td>
      <td>${b.name}</td>
      <td>${b.vno}</td>
      <td>${b.vtype}</td>
      <td>${new Date(b.time).toLocaleTimeString()}</td>
      <td>₹${fee}</td>
    </tr>`;
  });
}

// ALL
function renderAll(){
  renderGrid();
  renderHistory();
  updateLiveRegister();
}

renderAll();
</script>

</body>
</html>


